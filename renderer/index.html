
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://libplacebo.org/renderer/">
      
      
        <link rel="prev" href="../basic-rendering/">
      
      
        <link rel="next" href="../custom-shaders/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Rendering content: pl_frame, pl_renderer, and pl_queue - libplacebo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../style.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rendering-content-pl_frame-pl_renderer-and-pl_queue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="libplacebo" class="md-header__button md-logo" aria-label="libplacebo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            libplacebo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rendering content: pl_frame, pl_renderer, and pl_queue
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://code.videolan.org/videolan/libplacebo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m504 204.6-.7-1.8L433.6 21c-1.4-3.6-3.9-6.6-7.2-8.6-2.4-1.6-5.1-2.5-8-2.8s-5.7.1-8.4 1.1-5.1 2.7-7.1 4.8c-1.9 2.1-3.3 4.7-4.1 7.4l-47 144H161.3l-47.1-144c-.8-2.8-2.2-5.3-4.1-7.4-2-2.1-4.4-3.7-7.1-4.8-2.6-1-5.5-1.4-8.4-1.1s-5.6 1.2-8 2.8c-3.2 2-5.8 5.1-7.2 8.6L9.8 202.8l-.8 1.8c-10 26.2-11.3 55-3.5 82 7.7 26.9 24 50.7 46.4 67.6l.3.2.6.4 106 79.5c38.5 29.1 66.7 50.3 84.6 63.9 3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3c17.9-13.5 46.1-34.9 84.6-63.9l106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    videolan/libplacebo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="libplacebo" class="md-nav__button md-logo" aria-label="libplacebo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    libplacebo
  </label>
  
    <div class="md-nav__source">
      <a href="https://code.videolan.org/videolan/libplacebo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m504 204.6-.7-1.8L433.6 21c-1.4-3.6-3.9-6.6-7.2-8.6-2.4-1.6-5.1-2.5-8-2.8s-5.7.1-8.4 1.1-5.1 2.7-7.1 4.8c-1.9 2.1-3.3 4.7-4.1 7.4l-47 144H161.3l-47.1-144c-.8-2.8-2.2-5.3-4.1-7.4-2-2.1-4.4-3.7-7.1-4.8-2.6-1-5.5-1.4-8.4-1.1s-5.6 1.2-8 2.8c-3.2 2-5.8 5.1-7.2 8.6L9.8 202.8l-.8 1.8c-10 26.2-11.3 55-3.5 82 7.7 26.9 24 50.7 46.4 67.6l.3.2.6.4 106 79.5c38.5 29.1 66.7 50.3 84.6 63.9 3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3c17.9-13.5 46.1-34.9 84.6-63.9l106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
  </div>
  <div class="md-source__repository">
    videolan/libplacebo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Using
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Using
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic-rendering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic windowing / output example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Rendering content: pl_frame, pl_renderer, and pl_queue
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Rendering content: pl_frame, pl_renderer, and pl_queue
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#renderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Renderer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Renderer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frames" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frames
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shader-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shader cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frame-mixing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frame mixing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frame mixing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frame-queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frame queue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deinterlacing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deinterlacing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-shaders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Shaders (mpv .hook syntax)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Options
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glsl/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GLSL shader system
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#renderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Renderer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Renderer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frames" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frames
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shader-cache" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shader cache
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#frame-mixing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frame mixing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frame mixing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frame-queue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Frame queue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deinterlacing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deinterlacing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="rendering-content-pl_frame-pl_renderer-and-pl_queue">Rendering content: pl_frame, pl_renderer, and pl_queue</h1>
<p>This example roughly builds off the <a href="../basic-rendering/">previous entry</a>,
and as such will not cover the basics of how to create a window, initialize a
<code>pl_gpu</code> and get pixels onto the screen.</p>
<h2 id="renderer">Renderer</h2>
<p>The <code>pl_renderer</code> set of APIs represents the highest-level interface into
libplacebo, and is what most users who simply want to display e.g. a video
feed on-screen will want to be using.</p>
<p>The basic initialization is straightforward, requiring no extra parameters:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">pl_renderer</span><span class="w"> </span><span class="n">renderer</span><span class="p">;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pl_renderer_create</span><span class="p">(</span><span class="n">pllog</span><span class="p">,</span><span class="w"> </span><span class="n">gpu</span><span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">renderer</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="p">}</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="n">uninit</span><span class="p">()</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="p">{</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="n">pl_renderer_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">renderer</span><span class="p">);</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>What makes the renderer powerful is the large number of <code>pl_render_params</code> it
exposes. By default, libplacebo provides several presets to use:</p>
<ul>
<li><strong>pl_render_fast_params</strong>: Disables everything except for defaults. This is
  the fastest possible configuration.</li>
<li><strong>pl_render_default_params</strong>: Contains the recommended default parameters,
  including some slightly higher quality scaling, as well as dithering.</li>
<li><strong>pl_render_high_quality_params</strong>: A preset of reasonable defaults for a
  higher-end machine (i.e. anything with a discrete GPU). This enables most
  of the basic functionality, including upscaling, downscaling, debanding
  and better HDR tone mapping.</li>
</ul>
<p>Covering all of the possible options exposed by <code>pl_render_params</code> is
out-of-scope of this example and would be better served by looking at <a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/renderer.h#L94">the API
documentation</a>.</p>
<h3 id="frames">Frames</h3>
<p><a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/renderer.h#L503"><code>pl_frame</code></a>
is the struct libplacebo uses to group textures and their metadata together
into a coherent unit that can be rendered using the renderer. This is not
currently a dynamically allocated or refcounted heap object, it is merely a
struct that can live on the stack (or anywhere else). The actual data lives in
corresponding <code>pl_tex</code> objects referenced in each of the frame's planes.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span>
<span class="normal"><a href="#__codelineno-1-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">render_frame</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame</span><span class="w"> </span><span class="o">*</span><span class="n">image</span><span class="p">,</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_swapchain_frame</span><span class="w"> </span><span class="o">*</span><span class="n">swframe</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="n">pl_frame_from_swapchain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">swframe</span><span class="p">);</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pl_render_image</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">                           </span><span class="o">&amp;</span><span class="n">pl_render_default_params</span><span class="p">);</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Renderer state</p>
<p>The <code>pl_renderer</code> is conceptually (almost) stateless. The only thing that
is needed to get a different result is to change the render params, which
can be varied freely on every call, if the user desires.</p>
<p>The one case where this is not entirely true is when using frame mixing
(see below), or when using HDR peak detection. In this case, the renderer
can be explicitly reset using <code>pl_renderer_flush_cache</code>.</p>
</div>
<p>To upload frames, the easiest methods are made available as dedicated helpers
in
<a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/utils/upload.h"><code>&lt;libplacebo/utils/upload.h&gt;</code></a>,
and
<a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/utils/libav.h"><code>&lt;libplacebo/utils/libav.h&gt;</code></a>
(for AVFrames). In general, I recommend checking out the <a href="https://code.videolan.org/videolan/libplacebo/-/tree/master/demos">demo
programs</a>
for a clearer illustration of how to use them in practice.</p>
<h3 id="shader-cache">Shader cache</h3>
<p>The renderer internally generates, compiles and caches a potentially large
number of shader programs, some of which can be complex. On some platforms
(notably D3D11), these can be quite costly to recompile on every program
launch.</p>
<p>As such, the renderer offers a way to save/restore its internal shader cache
from some external location (managed by the API user). The use of this API is
highly recommended:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="hll"><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="nf">load_saved_cache</span><span class="p">();</span>
</span><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="hll"><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">store_saved_cache</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bytes</span><span class="p">);</span>
</span><a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="p">{</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pl_renderer_create</span><span class="p">(</span><span class="n">pllog</span><span class="p">,</span><span class="w"> </span><span class="n">gpu</span><span class="p">);</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">renderer</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="hll"><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">load_saved_cache</span><span class="p">();</span>
</span><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="hll"><span class="w">        </span><span class="n">pl_renderer_load</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">);</span>
</span><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="hll"><span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
</span><a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-2-15" name="__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="p">}</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="kt">void</span><span class="w"> </span><span class="nf">uninit</span><span class="p">()</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="p">{</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="hll"><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">cache_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pl_renderer_save</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</span><a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="hll"><span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">cache_bytes</span><span class="p">);</span>
</span><a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="hll"><span class="w">        </span><span class="n">pl_renderer_save</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="n">cache</span><span class="p">);</span>
</span><a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="hll"><span class="w">        </span><span class="n">store_saved_cache</span><span class="p">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="n">cache_bytes</span><span class="p">);</span>
</span><a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="hll"><span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">cache</span><span class="p">);</span>
</span><a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-2-28" name="__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">    </span><span class="n">pl_renderer_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">renderer</span><span class="p">);</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Cache safety</p>
<p>libplacebo performs only minimal validity checking on the shader cache,
and in general, cannot possibly guard against malicious alteration of such
files. Loading a cache from an untrusted source represents a remote code
execution vector.</p>
</div>
<h2 id="frame-mixing">Frame mixing</h2>
<p>One of the renderer's most powerful features is its ability to compensate
for differences in framerates between the source and display by using <a href="https://github.com/mpv-player/mpv/wiki/Interpolation">frame
mixing</a> to blend
adjacent frames together.</p>
<p>Using this API requires presenting the renderer, at each vsync, with a
<code>pl_frame_mix</code> struct, describing the current state of the vsync. In
principle, such structs can be constructed by hand. To do this, all of the
relevant frames (nearby the vsync timestamp) must be collected, and their
relative distances to the vsync determined, by normalizing all PTS values such
that the vsync represents time <code>0.0</code> (and a distance of <code>1.0</code> represents the
nominal duration between adjacent frames). Note that timing vsyncs, and
determining the correct vsync duration, are both left as problems for the user
to solve.<sup id="fnref:timing"><a class="footnote-ref" href="#fn:timing">1</a></sup>. Here could be an example of a valid struct:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame_mix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="p">.</span><span class="n">num_frames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="p">.</span><span class="n">frames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame</span><span class="w"> </span><span class="o">*</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="cm">/* frame 0 */</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="cm">/* frame 1 */</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span><span class="cm">/* ... */</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="cm">/* frame 5 */</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p">.</span><span class="n">signatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">        </span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1</span><span class="p">,</span><span class="w"> </span><span class="mh">0x2</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4</span><span class="p">,</span><span class="w"> </span><span class="mh">0x5</span><span class="w"> </span><span class="c1">// (1)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="p">.</span><span class="n">timestamps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">        </span><span class="mf">-2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.4</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">1.6</span><span class="p">,</span><span class="w"> </span><span class="mf">2.6</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="p">.</span><span class="n">vsync_duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="c1">// 24 fps video on 60 fps display</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="p">}</span>
</code></pre></div>
<ol>
<li>
<p>These must be unique per frame, but always refer to the same frame. For
    example, this could be based on the frame's PTS, the frame's numerical ID
    (in order of decoding), or some sort of hash. The details don't matter,
    only that this uniquely identifies specific frames.</p>
</li>
<li>
<p>Typically, for CFR sources, frame timestamps will always be separated in
    this list by a distance of 1.0. In this example, the vsync falls roughly
    halfway (but not quite) in between two adjacent frames (with IDs 0x2 and
    0x3).</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Frame mixing radius</p>
<p>In this example, the frame mixing radius (as determined by
<code>pl_frame_mix_radius</code> is <code>3.0</code>, so we include all frames that fall within
the timestamp interval of <code>[-3, 3)</code>. In general, you should consult this
function to determine what frames need to be included in the
<code>pl_frame_mix</code> - though including more frames than needed is not an error.</p>
</div>
<h3 id="frame-queue">Frame queue</h3>
<p>Because this API is rather unwieldy and clumsy to use directly, libplacebo
provides a helper abstraction known as <code>pl_queue</code> to assist in transforming
some arbitrary source of frames (such as a video decoder) into nicely packed
<code>pl_frame_mix</code> structs ready for consumption by the <code>pl_renderer</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;libplacebo/utils/frame_queue.h&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">pl_queue</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pl_queue_create</span><span class="p">(</span><span class="n">gpu</span><span class="p">);</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="p">}</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="kt">void</span><span class="w"> </span><span class="nf">uninit</span><span class="p">()</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">{</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="n">pl_queue_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">);</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This queue can be interacted with through a number of mechanisms: either
pushing frames (blocking or non-blocking), or by having the queue poll frames
(via blocking or non-blocking callback) as-needed. For a full overview of the
various methods of pushing and polling frames, check the <a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/utils/frame_queue.h#L115">API
documentation</a>.</p>
<p>In this example, I will assume that we have a separate decoder thread pushing
frames into the <code>pl_queue</code> in a blocking manner:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">decoder_thread</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">frame</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* decode new frame */</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">        </span><span class="n">pl_queue_push_block</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">UINT64_MAX</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_source_frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">            </span><span class="p">.</span><span class="n">pts</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="cm">/* frame pts */</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">            </span><span class="p">.</span><span class="n">duration</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="cm">/* frame duration */</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">            </span><span class="p">.</span><span class="n">map</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="cm">/* map callback */</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">            </span><span class="p">.</span><span class="n">unmap</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="cm">/* unmap callback */</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">            </span><span class="p">.</span><span class="n">frame_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="n">pl_queue_push</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="c1">// signal EOF</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now, in our render loop, we want to call <code>pl_queue_update</code> with appropriate
values to retrieve the correct frame mix for each vsync:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">render_frame</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_swapchain_frame</span><span class="w"> </span><span class="o">*</span><span class="n">swframe</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="hll"><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame_mix</span><span class="w"> </span><span class="n">mix</span><span class="p">;</span>
</span><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="hll"><span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">pl_queue_status</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
</span><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="hll"><span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pl_queue_update</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mix</span><span class="p">,</span><span class="w"> </span><span class="n">pl_queue_params</span><span class="p">(</span>
</span><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="hll"><span class="w">        </span><span class="p">.</span><span class="n">pts</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="cm">/* time of next vsync */</span><span class="p">,</span>
</span><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="hll"><span class="w">        </span><span class="p">.</span><span class="n">radius</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">pl_frame_mix_radius</span><span class="p">(</span><span class="o">&amp;</span><span class="n">render_params</span><span class="p">),</span>
</span><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="hll"><span class="w">        </span><span class="p">.</span><span class="n">vsync_duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* if known */</span><span class="p">,</span>
</span><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="hll"><span class="w">        </span><span class="p">.</span><span class="n">timeout</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">UINT64_MAX</span><span class="p">,</span><span class="w"> </span><span class="c1">// (2)</span>
</span><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="hll"><span class="w">    </span><span class="p">));</span>
</span><a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="hll"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="hll"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PL_QUEUE_OK</span><span class="p">:</span>
</span><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="hll"><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="hll"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PL_QUEUE_EOF</span><span class="p">:</span>
</span><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="hll"><span class="w">        </span><span class="cm">/* no more frames */</span>
</span><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="hll"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="hll"><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">PL_QUEUE_ERR</span><span class="p">:</span>
</span><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="hll"><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
</span><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="hll"><span class="w">    </span><span class="c1">// (1)</span>
</span><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span><a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pl_frame</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="w">    </span><span class="n">pl_frame_from_swapchain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">swframe</span><span class="p">);</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="hll"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pl_render_image_mix</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mix</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
</span><a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">                               </span><span class="o">&amp;</span><span class="n">pl_render_default_params</span><span class="p">);</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>
<p>There is a fourth status, <code>PL_QUEUE_MORE</code>, which is returned only if the
    resulting frame mix is incomplete (and the timeout was reached) -
    basically this can only happen if the queue runs dry due to frames not
    being supplied fast enough.</p>
<p>In this example, since we are setting <code>timeout</code> to <code>UINT64_MAX</code>, we will
never get this return value.</p>
</li>
<li>
<p>Setting this makes <code>pl_queue_update</code> block indefinitely until sufficiently
    many frames have been pushed into the <code>pl_queue</code> from our separate
    decoding thread.</p>
</li>
</ol>
<h3 id="deinterlacing">Deinterlacing</h3>
<p>The frame queue also vastly simplifies the process of performing
motion-adaptive temporal deinterlacing, by automatically linking together
adjacent fields/frames. To take advantage of this, all you need to do is set
the appropriate field (<code>pl_source_frame.first_frame</code>), as well as enabling
<a href="https://code.videolan.org/videolan/libplacebo/-/blob/master/src/include/libplacebo/renderer.h#L186">deinterlacing
parameters</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:timing">
<p>However, this may change in the future, as the recent introduction of
  the Vulkan display timing extension may result in display timing feedback
  being added to the <code>pl_swapchain</code> API. That said, as of writing, this has
  not yet happened.&#160;<a class="footnote-backref" href="#fnref:timing" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017-2022 Niklas Haas
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>